import streamlit as st
import requests
from bs4 import BeautifulSoup
import re

st.set_page_config(page_title="è™ä¹‹ç©´ä»£è³¼åŠ©æ‰‹", page_icon="ğŸ¯")
st.title("ğŸ¯ è™ä¹‹ç©´åƒ¹æ ¼è¨ˆç®—å™¨")

url = st.text_input("è«‹è²¼ä¸Šå•†å“ç¶²å€ï¼š")
category = st.selectbox("è«‹é¸æ“‡åˆ†é¡ï¼š", ["åˆ†é¡1ï¼šè¦ªå‹è¨ˆåƒ¹", "åˆ†é¡2ï¼šå™—æµªå®¢æˆ¶", "åˆ†é¡3ï¼šè¦çš®å®¢æˆ¶"])

def calculate(jpy, cat):
    if cat == "åˆ†é¡1ï¼šè¦ªå‹è¨ˆåƒ¹":
        return round(jpy * 0.25) if jpy <= 1000 else round(jpy * 0.26)
    elif cat == "åˆ†é¡2ï¼šå™—æµªå®¢æˆ¶":
        return round(jpy * 0.30) if jpy <= 1000 else round(jpy * 0.32)
    elif cat == "åˆ†é¡3ï¼šè¦çš®å®¢æˆ¶":
        return round(jpy * 0.35) if jpy <= 1000 else round(jpy * 0.38)

if url:
    try:
        headers = {"User-Agent": "Mozilla/5.0"}
        res = requests.get(url, headers=headers)
        soup = BeautifulSoup(res.text, 'html.parser')
        # æŠ“å–åƒ¹æ ¼æ¨™ç±¤
        price_tag = soup.select_one(".price-taxin")
        if price_tag:
            jpy = int(re.sub(r'[^\d]', '', price_tag.text))
            tw_price = calculate(jpy, category)
            st.success(f"æ—¥å¹£åƒ¹æ ¼ï¼š{jpy} å††")
            st.metric("æœ€çµ‚å°å¹£é‡‘é¡", f"NT$ {tw_price}")
        else:
            st.error("æ‰¾ä¸åˆ°åƒ¹æ ¼ï¼Œè«‹æª¢æŸ¥ç¶²å€æ˜¯å¦ç‚ºå•†å“é é¢ã€‚")
    except:
        st.error("ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚")